apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: kube-prometheus-stack
  namespace: kube-infra
spec:
  chart:
    spec:
      # renovate: registryUrl=https://prometheus-community.github.io/helm-charts
      chart: kube-prometheus-stack
      version: "34.6.0"
  values:
    kubeEtcd:
      service:
        port: 2381
        targetPort: 2381
    prometheus:
      additionalPodMonitors:
      - additionalLabels: {}
        name: flux-system
        namespaceSelector:
          matchNames:
          - flux-system
        podMetricsEndpoints:
        - port: http-prom
        selector:
          matchExpressions:
          - key: app
            operator: In
            values:
            - helm-controller
            - source-controller
            - kustomize-controller
            - notification-controller
            - image-automation-controller
            - image-reflector-controller